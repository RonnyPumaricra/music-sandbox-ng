<nav class="stored-scales">
  @for (key of storedKeys(); track key) {
    <div
      [class.stored-key]="true"
      [class.active]="$index == activeKeyIndex()"
      (click)="storeKeyClick($index)"
    >
      <span class="root-note">
        {{ scalesService.getRootNoteName(key.rootNoteIndex) }}
      </span>
      {{ scalesService.getModeName(key.scaleIndex, key.modeIndex) }}
      <app-three-dots></app-three-dots>

      <app-cross class="delete" (click)="deleteKey($index);$event.stopPropagation()"></app-cross>
      <!-- <app-pen-outline class="edit"></app-pen-outline> -->
    </div>
  }
  <div
    class="add-key"
    (click)="addKey(0, 0, 0)"
  >
    <app-plus></app-plus>
    Add key
  </div>
</nav>

@if (activeKeyIndex() == -1) {
  <div class="key-editor default">
    <span>Choose a saved key</span>
  </div>
}
@else {
  <div class="key-editor">
    <div class="left">
      <h3>Root note</h3>
      <span class="current-root-note">
        {{ musicService.getNoteName(activeRootNote() ?? 0) }}
      </span>
      <span class="pick-root">Pick</span>
    </div>
    <div class="right">
      <div class="dropdown-wrapper">
        <h3>Scale</h3>
        <select [(ngModel)]="pickedScaleIndex" #scaleSelect (change)="pickedModeIndex = 0">
          @for (scale of scaleOptions; track $index) {
            <option [value]="$index">{{ scale }}</option>
          }
        </select>
  
        <div class="dropdown-info">3 extra notes</div>
      </div>
      <div class="dropdown-wrapper">
        <h3>Mode</h3>
        <select [(ngModel)]="pickedModeIndex">
          @for (mode of musicService.scales.at(pickedScaleIndex)?.modes; track $index) {
            @if (mode != null) {
              <option [value]="$index">{{ mode }}</option>
            }
          }
        </select>
        <div class="dropdown-info">2 modded notes</div>
      </div>
  
      
    </div>
    <div class="bottom">
      <button
        class="save-key"
        (click)="updateKey(0, pickedScaleIndex, pickedModeIndex, activeKeyIndex())"
      >Apply</button>
    </div>
  </div>
}